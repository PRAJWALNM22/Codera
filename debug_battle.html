<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battle Mode Debug</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/clike/clike.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: white; }
        .container { max-width: 1200px; margin: 0 auto; }
        .editor-section { margin: 20px 0; }
        .language-selector { margin-bottom: 10px; }
        .language-selector select { padding: 5px; margin-right: 10px; }
        .editor-container { border: 2px solid #333; border-radius: 5px; min-height: 300px; }
        .chat-section { margin-top: 30px; padding: 20px; border: 2px solid #444; border-radius: 5px; }
        .chat-messages { background: #2a2a2a; padding: 10px; height: 200px; overflow-y: auto; margin-bottom: 10px; border-radius: 5px; }
        .chat-input { display: flex; gap: 10px; }
        .chat-input input { flex-grow: 1; padding: 8px; border: none; background: #333; color: white; border-radius: 3px; }
        .chat-input button { padding: 8px 15px; background: #0066cc; color: white; border: none; border-radius: 3px; cursor: pointer; }
        .debug-info { background: #2a2a2a; padding: 15px; margin: 20px 0; border-radius: 5px; }
        .status { margin: 5px 0; font-family: monospace; font-size: 12px; }
        .status.good { color: #4ade80; }
        .status.bad { color: #ef4444; }
        .status.warn { color: #fbbf24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üêõ Battle Mode Debug Test</h1>
        
        <div class="debug-info">
            <h3>üìä Debug Information</h3>
            <div id="debug-status">
                <div class="status">Loading debug info...</div>
            </div>
        </div>
        
        <div class="editor-section">
            <h2>üîß CodeMirror Editor Test</h2>
            <div class="language-selector">
                <label>Language: </label>
                <select id="language-select">
                    <option value="javascript">JavaScript</option>
                    <option value="python">Python</option>
                    <option value="java">Java</option>
                    <option value="cpp">C++</option>
                </select>
                <button onclick="debugEditor()">Debug Editor</button>
                <button onclick="clearEditor()">Clear Editor</button>
            </div>
            <div id="editor-container" class="editor-container"></div>
        </div>
        
        <div class="chat-section">
            <h2>üí¨ Chat Test</h2>
            <div id="chat-messages" class="chat-messages">
                <div style="color: #888;">No messages yet...</div>
            </div>
            <div class="chat-input">
                <input type="text" id="chat-input" placeholder="Type a message..." onkeydown="handleChatKey(event)">
                <button onclick="sendMessage()">Send</button>
                <button onclick="debugChat()">Debug Chat</button>
            </div>
        </div>
    </div>

    <script>
        let editor = null;
        let chatMessages = [];
        let initCount = 0;
        
        const STARTER_CODE = {
            javascript: 'function twoSum(nums, target) {\n  // Write your JavaScript code here\n}',
            python: 'def two_sum(nums, target):\n    # Write your Python code here',
            java: 'public int[] twoSum(int[] nums, int target) {\n    // Write your Java code here\n    return new int[0];\n}',
            cpp: 'vector<int> twoSum(vector<int>& nums, int target) {\n    // Write your C++ code here\n    return {};\n}'
        };
        
        function updateDebugStatus() {
            const status = document.getElementById('debug-status');
            status.innerHTML = `
                <div class="status good">‚úÖ CodeMirror loaded: ${typeof CodeMirror !== 'undefined'}</div>
                <div class="status ${editor ? 'good' : 'bad'}">${editor ? '‚úÖ' : '‚ùå'} Editor instance: ${editor ? 'Created' : 'None'}</div>
                <div class="status good">üî¢ Init count: ${initCount}</div>
                <div class="status good">üí¨ Chat messages: ${chatMessages.length}</div>
                <div class="status good">üïí Last update: ${new Date().toLocaleTimeString()}</div>
            `;
        }
        
        function initializeEditor() {
            console.log('üîß Attempting to initialize editor...');
            const container = document.getElementById('editor-container');
            
            if (!container) {
                console.error('‚ùå Container not found!');
                return;
            }
            
            if (!CodeMirror) {
                console.error('‚ùå CodeMirror not loaded!');
                return;
            }
            
            if (editor) {
                console.log('‚ö†Ô∏è Editor already exists, destroying old one...');
                editor.toTextArea();
                editor = null;
            }
            
            // Clear container completely
            container.innerHTML = '';
            
            initCount++;
            console.log('üöÄ Creating editor instance #' + initCount);
            
            editor = CodeMirror(container, {
                value: STARTER_CODE.javascript,
                mode: 'javascript',
                theme: 'dracula',
                lineNumbers: true,
                indentUnit: 4,
                smartIndent: true
            });
            
            console.log('‚úÖ Editor created successfully');
            updateDebugStatus();
        }
        
        function switchLanguage(lang) {
            console.log('üîÑ Switching to:', lang);
            
            if (!editor) {
                console.error('‚ùå No editor instance!');
                return;
            }
            
            const mode = lang === 'javascript' ? 'javascript' :
                        lang === 'python' ? 'python' :
                        lang === 'java' ? 'text/x-java' :
                        lang === 'cpp' ? 'text/x-c++src' : 'javascript';
            
            console.log('üìù Setting mode to:', mode);
            console.log('üìÑ Setting code to:', STARTER_CODE[lang]);
            
            editor.setOption('mode', mode);
            editor.setValue(STARTER_CODE[lang]);
            
            console.log('‚úÖ Language switch completed');
            console.log('üîç Current editor value:', editor.getValue());
        }
        
        function debugEditor() {
            console.log('üêõ EDITOR DEBUG INFO:');
            console.log('Editor instance:', editor);
            console.log('Container:', document.getElementById('editor-container'));
            console.log('Current value:', editor ? editor.getValue() : 'No editor');
            console.log('Init count:', initCount);
            
            if (editor) {
                console.log('Editor options:', {
                    mode: editor.getOption('mode'),
                    theme: editor.getOption('theme'),
                    lineNumbers: editor.getOption('lineNumbers')
                });
            }
        }
        
        function clearEditor() {
            if (editor) {
                editor.setValue('');
                console.log('üßπ Editor cleared');
            }
        }
        
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (!message) {
                console.log('‚ö†Ô∏è Empty message');
                return;
            }
            
            console.log('üí¨ Sending message:', message);
            
            const messageObj = {
                id: Date.now(),
                text: message,
                sender: 'You',
                timestamp: new Date()
            };
            
            chatMessages.push(messageObj);
            input.value = '';
            
            displayMessages();
            updateDebugStatus();
        }
        
        function displayMessages() {
            const container = document.getElementById('chat-messages');
            
            if (chatMessages.length === 0) {
                container.innerHTML = '<div style="color: #888;">No messages yet...</div>';
                return;
            }
            
            container.innerHTML = chatMessages.map(msg => 
                `<div><strong style="color: #60a5fa;">${msg.sender}:</strong> ${msg.text} <span style="color: #888; font-size: 11px;">${msg.timestamp.toLocaleTimeString()}</span></div>`
            ).join('');
            
            container.scrollTop = container.scrollHeight;
        }
        
        function handleChatKey(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                sendMessage();
            }
        }
        
        function debugChat() {
            console.log('üêõ CHAT DEBUG INFO:');
            console.log('Messages array:', chatMessages);
            console.log('Input element:', document.getElementById('chat-input'));
            console.log('Messages container:', document.getElementById('chat-messages'));
        }
        
        // Event listeners
        document.getElementById('language-select').addEventListener('change', function(e) {
            switchLanguage(e.target.value);
        });
        
        // Initialize everything
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Debug page loaded');
            updateDebugStatus();
            initializeEditor();
        });
        
        // Add some test messages
        setTimeout(() => {
            chatMessages.push({
                id: 1,
                text: 'Test message 1',
                sender: 'System',
                timestamp: new Date()
            });
            displayMessages();
            updateDebugStatus();
        }, 1000);
    </script>
</body>
</html>